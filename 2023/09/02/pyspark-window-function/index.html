<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Adarsh Shukla">





<title>pyspark window function | adarshshukla</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Adarsh Shukla</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Adarsh Shukla</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">pyspark window function</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Adarsh Shukla</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 2, 2023&nbsp;&nbsp;22:16:08</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="PySpark-Window-Functions"><a href="#PySpark-Window-Functions" class="headerlink" title="PySpark Window Functions"></a>PySpark Window Functions</h1><p>Window functions in PySpark are a powerful tool for performing calculations across a set of rows related to the current row within a DataFrame. These functions allow you to create advanced analytics and aggregations that involve ordering, ranking, and statistical computations in a flexible manner.</p>
<p>Window functions operate on a “window” of rows that are defined by an ordered range of data. The window specification determines which rows are included in the window for each row in the DataFrame. This specification typically consists of:</p>
<ul>
<li><p><strong>Partition By</strong>: This clause divides the rows into partitions or groups based on one or more columns. The window function operates independently within each partition.</p>
</li>
<li><p><strong>Order By</strong>: This clause defines the order in which rows are processed within each partition. It establishes the logical order of rows in the window.</p>
</li>
</ul>
<p>Commonly used PySpark window functions include:</p>
<ul>
<li><p><strong>Ranking Functions</strong>: These functions assign a rank to each row within a partition based on the specified order. Common ranking functions include <code>rank()</code>, <code>dense_rank()</code>, and <code>ntile()</code>.</p>
</li>
<li><p><strong>Aggregate Functions</strong>: You can calculate aggregate values, such as sums, averages, and maximum&#x2F;minimum values, over a window of rows. Functions like <code>sum()</code>, <code>avg()</code>, <code>max()</code>, and <code>min()</code> can be used.</p>
</li>
<li><p><strong>Lead and Lag Functions</strong>: These functions allow you to access values from the “next” or “previous” rows within the window. They are useful for creating time-series calculations.</p>
</li>
<li><p><strong>Window Spec</strong>: This function is used to define the window specification within the <code>over()</code> clause, specifying the partitioning and ordering criteria.</p>
</li>
</ul>
<p>Here’s an example of using a PySpark window function to calculate the average salary within each department, taking advantage of the <code>partition by</code> clause:</p>
<pre><code class="python">from pyspark.sql import SparkSession
from pyspark.sql.window import Window
from pyspark.sql.functions import col, avg

# Initialize Spark session
spark = SparkSession.builder.appName(&quot;WindowFunctionExample&quot;).getOrCreate()

# Create a DataFrame with employee data
df = spark.createDataFrame([...])

# Define a window specification partitioned by department
window_spec = Window.partitionBy(&quot;department&quot;)

# Calculate the average salary within each department
df.withColumn(&quot;avg_salary&quot;, avg(col(&quot;salary&quot;)).over(window_spec)).show()
</code></pre>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Adarsh Shukla</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://www.adarshshukla.com/2023/09/02/pyspark-window-function/">http://www.adarshshukla.com/2023/09/02/pyspark-window-function/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span><strong>Learning</strong> leads to <strong>growth</strong>.</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/pyspark/"># pyspark</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2023/09/02/Rails-Active-Record/">Rails Active Record</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Adarsh Shukla | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>